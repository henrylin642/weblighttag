<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Antigravity Optical ID Reader</title>
    <link rel="stylesheet" href="styles.css" />
    <script>
      window.Module = {
        onRuntimeInitialized() {
          window.__cvReady = true;
        }
      };
    </script>
  </head>
  <body>
    <div class="app">
      <header class="header">
        <div>
          <h1>Antigravity Optical ID Reader</h1>
          <p>Web-based LED optical ID decoding (96-bit payload → 16-bit core ID)</p>
        </div>
        <div class="status" id="status">Idle</div>
      </header>

      <main class="main">
        <section class="panel video-panel">
          <div class="video-fixed">
            <div class="video-wrap">
              <video id="video" playsinline muted></video>
              <canvas id="processed"></canvas>
              <canvas id="overlay"></canvas>
            </div>
          </div>
          <div class="video-spacer"></div>
          <div class="video-actions">
            <button id="btnStart">啟動相機 Start Camera</button>
            <button id="btnStop" disabled>停止 Stop</button>
          </div>

          <!-- 簡化版：只保留5-LED定位 -->
        </section>

        <section class="panel" style="background: linear-gradient(135deg, #1a3a52 0%, #2a4a62 100%); border: 2px solid #3a6a82;">
          <h2>📍 6DoF定位系統 (5-LED藍燈)</h2>
          <div class="hint" style="background: #2a5a72; padding: 12px; border-radius: 4px;">
            <strong>🚀 快速使用（智能檢測）：</strong><br>
            1️⃣ 將5-LED設備對準畫面中心（2-3公尺）<br>
            2️⃣ 點擊「🎯 開始自動偵測」立即定位<br>
            3️⃣ 查看位置、距離信息<br>
            <br>
            <strong>💡 提示：</strong>使用固定參數+ROI智能檢測，無需手動校準
          </div>
          <div class="config-grid">
            <label>環境模式
              <select id="cfgEnvMode" disabled>
                <option value="dark">暗環境 (閾值35)</option>
                <option value="normal" selected>正常室內 (閾值40)</option>
                <option value="bright">明亮環境 (閾值50)</option>
              </select>
            </label>
          </div>
          <div class="video-actions">
            <button id="btnAutoHsv" disabled style="background: #2a7a52; font-weight: bold; display: none;">🎨 自動校準 HSV</button>
          </div>
          <div class="video-actions">
            <button id="btnLocAuto" disabled style="background: #2a6a92; font-size: 16px; font-weight: bold;">🎯 開始自動偵測</button>
            <button id="btnLocClear" disabled>清除定位點</button>
            <button id="btnLocSolve" disabled>手動計算定位</button>
          </div>
          <div class="config-grid">
            <label>fx
              <input id="cfgFx" type="number" step="1" />
            </label>
            <label>fy
              <input id="cfgFy" type="number" step="1" />
            </label>
            <label>cx
              <input id="cfgCx" type="number" step="1" />
            </label>
            <label>cy
              <input id="cfgCy" type="number" step="1" />
            </label>
          </div>
          <div class="output-row">
            <div>
              <div class="label">PnP 狀態</div>
              <div id="locStatus">-</div>
            </div>
            <div>
              <div class="label">位置 (mm)</div>
              <div id="locPos">-</div>
            </div>
            <div>
              <div class="label">姿態 (deg)</div>
              <div id="locRot">-</div>
            </div>
            <div>
              <div class="label">距離 (m)</div>
              <div id="locDist">-</div>
            </div>
          </div>
          <div class="output-row">
            <div>
              <div class="label">解析度</div>
              <div id="camRes">-</div>
            </div>
            <div>
              <div class="label">藍燈品質</div>
              <div id="ledQuality">-</div>
            </div>
          </div>
          <div class="video-actions">
            <button id="btnLedQuality" disabled>估算藍燈品質</button>
          </div>
          <div class="log" id="qualityLog"></div>
        </section>

        <!-- 已刪除：Device Check, Decoder Config, Live Metrics -->

        <section class="panel output">
          <h2>📊 Console診斷日誌</h2>
          <div class="log" id="log" style="height: 200px; overflow-y: auto;"></div>
        </section>
      </main>
    </div>

    <script src="https://docs.opencv.org/4.x/opencv.js"></script>
    <script src="geometry-based-detection.js"></script>
    <script src="app.js"></script>
  </body>
</html>
