# 更新日誌

## v1.1 - 2026-02-08 (UI改進與HSV校準修復)

### 🐛 Bug修復

#### HSV自動校準算法改進
**問題**: 自動校準HSV後噪點更多，無法正確檢測LED
**原因**:
1. 檢測色調範圍太窄 (95-140)
2. 飽和度和明度閾值太高
3. 未使用藍光差分預過濾
4. 未更新定位器參數

**解決方案**:
- ✅ 增加藍光差分預過濾 `B-(R+G)/2 > 30`
- ✅ 放寬色調範圍：100-145 (對應200-290度)
- ✅ 降低飽和度/明度閾值：從50/40改為30/30
- ✅ 使用更寬鬆的百分位數：10%-90%
- ✅ 自動更新定位器HSV參數
- ✅ 添加詳細日誌輸出

**代碼位置**: [app.js:1735-1790](app.js:1735)

### 🎨 UI/UX改進

#### 定位功能可見性提升
**問題**: 用戶找不到"只顯示定位LED"和"開始自動偵測"按鈕
**原因**: UI元素位置分散，不夠醒目

**解決方案**:
- ✅ 重組視頻控制區域佈局
- ✅ 添加醒目的6DoF定位提示框（藍色背景）
- ✅ "只顯示定位LED"選項前置並加強標記
- ✅ 定位面板用漸變背景和邊框突出
- ✅ "開始自動偵測"按鈕加大加粗，藍色背景
- ✅ "自動校準HSV"按鈕移到定位面板，綠色背景
- ✅ 添加清晰的使用步驟說明
- ✅ 添加emoji圖標提升可讀性
- ✅ 按鈕文字中英雙語

**代碼位置**: [index.html:36-145](index.html:36)

### 📝 詳細改動

#### app.js
```javascript
// 1. HSV自動校準改進 (1735-1790行)
- 新增藍光差分預過濾
- 優化色調檢測範圍 (100-145)
- 降低飽和度/明度閾值 (30/30)
- 改進百分位數計算 (10%-90%)
- 自動更新localizer參數
- 添加詳細日誌
```

#### index.html
```html
<!-- 1. 視頻控制區域重組 (36-76行) -->
- 添加6DoF定位使用提示框
- "只顯示定位LED"選項前置
- 按鈕文字中英雙語
- 分組更清晰

<!-- 2. 定位面板UI增強 (137-146行) -->
- 漸變背景色 (#1a3a52 → #2a4a62)
- 邊框強調 (2px #3a6a82)
- 使用步驟說明
- 按鈕視覺分級：
  * 自動校準HSV: 綠色 #2a7a52
  * 開始自動偵測: 藍色 #2a6a92, 16px, bold
  * 其他按鈕: 默認樣式
```

### 🎯 預期效果

**HSV校準**:
- ✅ 更準確的藍色LED檢測
- ✅ 減少噪點干擾
- ✅ 自動優化參數
- ✅ 提供診斷信息

**UI體驗**:
- ✅ 一眼找到定位功能
- ✅ 清晰的操作流程
- ✅ 視覺層次分明
- ✅ 手機端更友好

### 📱 手機測試建議

#### 測試步驟
1. 打開應用，允許相機權限
2. 查看是否能清楚看到藍色的"6DoF定位模式"提示框
3. 勾選"只顯示定位LED"
4. 點擊綠色的"🎨 自動校準 HSV"
5. 點擊藍色的"🎯 開始自動偵測"
6. 觀察檢測效果

#### 預期結果
- ✅ 提示框醒目可見
- ✅ 按鈕位置明確
- ✅ HSV校準後能檢測到LED
- ✅ 自動偵測成功率提升

#### 如果仍有問題
1. 檢查console日誌，查看HSV校準的像素數量
2. 手動調整HSV參數：
   - Hue: 200-260度
   - Sat: 0.3-0.8
   - Val: 0.3-0.8
3. 確保LED亮度足夠
4. 距離保持在2-3公尺

### 🔄 後續優化方向

1. **更智能的HSV校準**
   - 支持多次採樣取平均
   - 根據環境光自動調整
   - 保存歷史最佳參數

2. **UI響應式優化**
   - 針對手機屏幕尺寸優化佈局
   - 添加摺疊面板減少滾動
   - 固定關鍵按鈕到頂部

3. **性能優化**
   - 降低手機端處理頻率
   - 智能降低解析度
   - 優化OpenCV.js加載

---

## v1.0 - 2026-02-08 (初始整合)

### ✨ 新功能
- 完整6DoF定位系統
- 5個核心類別
- 藍光差分 + HSV檢測
- 卡爾曼濾波追蹤
- PnP姿態估計

詳見 [6DoF-INTEGRATION-GUIDE.md](6DoF-INTEGRATION-GUIDE.md)
